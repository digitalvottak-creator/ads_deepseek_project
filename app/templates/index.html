<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AI Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<!-- ===== Sidebar ===== -->
<div class="sidebar">
    <h2>ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹</h2>
    <a href="/">
        <div class="tab {% if active_tab == 'avatr' %}selected{% endif %}">ðŸ“Œ AVATR</div>
    </a>
    <a href="/mitsubishi">
        <div class="tab {% if active_tab == 'mitsubishi' %}selected{% endif %}">ðŸ“Œ Mitsubishi</div>
    </a>
</div>

<!-- ===== Main ===== -->
<div class="main">

    <!-- Chart -->
    <div class="top">
        {% for img in images %}
            <div class="zigzag">
                <img src="{{ img }}" alt="Graph">
            </div>
        {% endfor %}
    </div>

    <!-- Chat -->
    <div class="bottom">
        <div class="chat" id="chat"></div>

    </div>

</div>

<script>
    const chat = document.getElementById("chat");
    const thoughtFile = "{{ thought }}";

    function addMessage(prefix, className) {
        const msg = document.createElement("pre"); // <pre> ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ Ð²ÑÐµ Ð¾Ñ‚ÑÑ‚ÑƒÐ¿Ñ‹
        msg.className = className;
        msg.textContent = prefix;
        chat.appendChild(msg);
        return msg;
    }

    // Ð Ð°Ð·Ð±Ð¸Ð²ÐºÐ° ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð½Ð° ÐºÑƒÑÐºÐ¸ â‰¤ maxLen Ð±ÐµÐ· Ñ€Ð°Ð·Ñ€Ñ‹Ð²Ð° ÑÐ»Ð¾Ð²
    function splitByWords(text, maxLen = 300) {
        const result = [];
        let remaining = text;

        while (remaining.length > 0) {
            if (remaining.length <= maxLen) {
                result.push(remaining);
                break;
            }

            // Ð‘ÐµÑ€ÐµÐ¼ ÐºÑƒÑÐ¾Ðº Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð½Ð¾ maxLen, Ð·Ð°Ñ‚ÐµÐ¼ Ð¸Ñ‰ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð¿Ñ€Ð¾Ð±ÐµÐ»
            let slice = remaining.slice(0, maxLen);
            let lastSpace = slice.lastIndexOf(" ");
            if (lastSpace === -1) lastSpace = maxLen; // ÐµÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð±ÐµÐ»Ð¾Ð² Ð½ÐµÑ‚, Ñ€ÐµÐ¶ÐµÐ¼ Ð¿Ð¾ maxLen

            result.push(slice.slice(0, lastSpace).trim());
            remaining = remaining.slice(lastSpace).trim();
        }

        return result;
    }

    function simulateAIThinking() {
        fetch(thoughtFile)
            .then(response => response.text())
            .then(text => {
                const lines = text.split("\n"); // ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ½Ð¾ÑÑ‹
                let index = 0;
                const aiMessage = addMessage("ðŸ¤– ", "ai");

                const interval = setInterval(() => {
                    if (index < lines.length) {
                        let line = lines[index];
                        let chunks = splitByWords(line, 215);

                        // Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ ÐºÑƒÑÐºÐ¸ Ñ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¸Ð¼ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð¼
                        chunks.forEach((chunk, i) => {
                            setTimeout(() => {
                                aiMessage.textContent += "\n" + chunk;
                                chat.scrollTop = chat.scrollHeight;
                            }, i * 100); // 100ms Ð¼ÐµÐ¶Ð´Ñƒ ÐºÑƒÑÐºÐ°Ð¼Ð¸
                        });

                        index++;
                    } else {
                        clearInterval(interval);
                    }
                }, 100); // Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» Ð¼ÐµÐ¶Ð´Ñƒ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ð¼Ð¸ ÑÑ‚Ñ€Ð¾ÐºÐ°Ð¼Ð¸
            })
            .catch(err => console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ñ„Ð°Ð¹Ð»Ð°:", err));
    }

    window.onload = simulateAIThinking;
</script>


</body>
</html>
